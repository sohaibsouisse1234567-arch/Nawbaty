<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>نوبتي - حجز موعد</title>
<style>
body{
  margin:0; padding:20px;
  font-family: Arial, sans-serif;
  background:url('background.png') no-repeat center center fixed;
  background-size:cover;
  min-height:100vh;
  position:relative;
}
body::before{
  content:""; position:absolute; top:0;left:0;
  width:100%; height:100%; background:rgba(255,255,255,0.85); z-index:0;
}
*{position:relative;z-index:1}

h2{text-align:center;color:#1e3a8a}
@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}
#infoMessage{ text-align:center;font-weight:bold;color:red;margin:10px 0;animation:blink 1s infinite;}
#currentDate,#currentTime{ text-align:center;color:#1e40af;font-size:14px;}
input{ width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #aaa;font-size:15px;}
.slot{ background:#eef2ff;padding:10px;margin:6px 0;border-radius:6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.slot.booked{background:#c7f9cc;}
.slot button{ background:red;color:white;border:none;border-radius:4px;padding:4px 8px;}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:14px;}
th,td{border:1px solid #aaa;padding:6px;text-align:center;}
th{background:#1e40af;color:white;}
#doctorSection{display:none}
</style>
</head>
<body>

<h2>نوبتي - احجز موعدك</h2>
<div id="infoMessage"></div>
<div id="currentDate"></div>
<div id="currentTime"></div>

<input id="firstName" placeholder="الاسم">
<input id="lastName" placeholder="اللقب">
<input id="phone" placeholder="رقم الهاتف">

<h3>المواعيد</h3>
<div id="slots"></div>

<h3>للطبيب</h3>
<input id="doctorCode" placeholder="كود الطبيب">

<div id="doctorSection">
<table>
<thead><tr><th>الوقت</th><th>الاسم</th><th>اللقب</th><th>الهاتف</th></tr></thead>
<tbody id="doctorTable"></tbody>
</table>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "ضع هنا apiKey",
  authDomain: "ضع هنا authDomain",
  databaseURL: "ضع هنا databaseURL",
  projectId: "ضع هنا projectId",
  storageBucket: "ضع هنا storageBucket",
  messagingSenderId: "ضع هنا messagingSenderId",
  appId: "ضع هنا appId"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== الوقت والتاريخ =====
let today=new Date();
let currentDate=today.toISOString().split("T")[0];
const infoMessage=document.getElementById("infoMessage");
const currentDateDiv=document.getElementById("currentDate");
const currentTimeDiv=document.getElementById("currentTime");
currentDateDiv.textContent="تاريخ اليوم: "+currentDate;

function updateTime(){
  const now=new Date();
  currentTimeDiv.textContent="الساعة الآن: "+
    now.getHours().toString().padStart(2,"0")+":"+
    now.getMinutes().toString().padStart(2,"0")+":"+
    now.getSeconds().toString().padStart(2,"0");

  const target=new Date(); target.setHours(18,0,0,0);
  let diff=target-now;
  if(diff>0){
    let h=Math.floor(diff/1000/60/60);
    let m=Math.floor(diff/1000/60%60);
    let s=Math.floor(diff/1000%60);
    infoMessage.textContent="هام: الوقت المتبقي للحجز الجديد: "+h+" س "+m+" د "+s+" ث";
  }else{
    infoMessage.textContent="هام: الحجز متاح الآن";
  }
}
setInterval(updateTime,1000);
updateTime();

// ===== المواعيد =====
function generateSlots(start,end){
  let arr=[];
  for(let h=start;h<end;h++){
    for(let m of [0,15,30,45]){
      arr.push(h.toString().padStart(2,"0")+":"+m.toString().padStart(2,"0"));
    }
  }
  return arr;
}
const slots=[...generateSlots(8,12),...generateSlots(13,16)];

// ===== عرض المواعيد =====
const container=document.getElementById("slots");
const firstName=document.getElementById("firstName");
const lastName=document.getElementById("lastName");
const phone=document.getElementById("phone");
function renderSlots(){
  container.innerHTML="";
  slots.forEach(t=>{
    db.ref("bookings/"+currentDate+"/"+t).get().then(snapshot=>{
      const b=snapshot.val();
      const div=document.createElement("div");
      div.className="slot";
      if(b){
        div.classList.add("booked");
        div.innerHTML=b.first+" - محجوز <button>إلغاء</button>";
        div.querySelector("button").onclick=()=>{
          const p=prompt("رقم الهاتف");
          if(p===b.phone){
            db.ref("bookings/"+currentDate+"/"+t).remove();
          }
        };
      }else{
        div.textContent=t;
        div.onclick=()=>{
          const f=firstName.value.trim();
          const l=lastName.value.trim();
          const ph=phone.value.trim();
          if(!f||!l||!ph){alert("اكمل البيانات"); return;}
          db.ref("bookings/"+currentDate+"/"+t).set({first:f,last:l,phone:ph,date:currentDate});
          firstName.value=lastName.value=phone.value="";
        };
      }
      container.appendChild(div);
    });
  });
}
renderSlots();
db.ref("bookings/"+currentDate).on("value",renderSlots);

// ===== جدول الطبيب =====
const codeInput=document.getElementById("doctorCode");
const doctorSection=document.getElementById("doctorSection");
const doctorTable=document.getElementById("doctorTable");
codeInput.oninput=()=>{
  doctorSection.style.display=codeInput.value==="2026"?"block":"none";
  renderDoctor();
};

function renderDoctor(){
  doctorTable.innerHTML="";
  db.ref("bookings/"+currentDate).get().then(snapshot=>{
    const data=snapshot.val();
    if(data){
      Object.keys(data).sort().forEach(t=>{
        const b=data[t];
        const row=document.createElement("tr");
        row.innerHTML=`<td>${t}</td><td>${b.first}</td><td>${b.last}</td><td>${b.phone}</td>`;
        doctorTable.appendChild(row);
      });
    }
  });
}
db.ref("bookings/"+currentDate).on("value",renderDoctor);

</script>
</body>
</html>
